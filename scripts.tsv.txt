# universal_grass_peps v1.4 scripts							
#							
box in flow chart	step desc	script	custom and BioPerl modules used	external apps run	run from	input 	output
box 1	remove redundant peps	EnsemblPlants/remove_redundant.pl	Pipeline.pm		command line	gene models (*.fa)	gene models (*.nr.fa)
box 1	collapses very similar Zm and Os peps into clusters and finds blastp hits in other grasses	blastp/refsp-blastp.pl	Pipeline.pm Blastp.pm	BLAST+	command line	gene models (*.nr.fa)	"Zm , Os clusters (*.txt), Os, Zm hits (*.txt)"
box 1	"converts format of ensembl Biomart ortholog tables to one file for each for Zm, Os"	EnsemblPlants/orthologs/get_orths.pl	Pipeline.pm Ortho.pm		command line	Ensembl ortholog tables for Os and Zm (*txt)	combined Zm/ Os ortholog files (*txt)
box 1	generates table of all exclusive orthologs for all grass sp for each Os / Zm cluster	EnsemblPlants/orthologs/generate_ortho_table.pl	Pipeline.pm Ortho.pm		command line	Zm/ Os ortholog files (*txt)	groups of exclusive orthologs for each rice/maize cluster (ortho.txt)
box 1	outputs sequences for all groups that have enough members and possible alternative sequences	EnsemblPlants/orthologs/write-all-grp-fa.pl	Pipeline.pm Ortho.pm Bio::SeqIO		command line	groups of exclusive orthologs for each rice/maize cluster (ortho.txt)	fasta files for each group and for alternative sequences
box 2	takes group info and sequences from ortholog step and generates best HMM scoring groups with 1 sequence per species (HMM1)	"optHMM1.sbatch : runs split-pipeline-statfiles.pl , 12 instances of optimise_hmms.pl. When complete join-pipeline-statfiles.pl to create HMM1"	Pipeline.pm Ortho.pm HMMs.pm Bio::SeqIO	MUSCLE    HMMER	slurm	fasta files for each group and for alternative sequences from otholog step	composition (HMM1.txt) multiple alignment files (*.msa.fa) and HMM files of optimised groups
box 3	Finds all grass pep top hits to HMM1 database not yet used in groups and writes their sequences	hmm1scan_grass.sbatch: runs hmmscan_allgm.pl none to make db then runs instances of hmmscan_allgm.pl HMM1 for each grass sp. Finally write_hmm1scan_hits.pl	Pipeline.pm HMMs.pm Bio::SeqIO	HMMER	slurm	"HMM1 files of optimised groups, group composition file, fasta files of all grass peps"	all grass hits to HMM1
box 3	takes group info and sequences from grass hits versus HMM1 and generates best HMM scoring groups with 1 sequence per species (HMM2)	"optHMM2.sbatch : runs split-pipeline-statfiles.pl , 12 instances of optimise_hmms.pl. When complete join-pipeline-statfiles.pl to create HMM2"	Pipeline.pm HMMs.pm Bio::SeqIO	MUSCLE    HMMER	slurm	all grass hits to HMM1	composition (HMM2.txt) multiple alignment files (*.msa.fa) and HMM files of optimised groups
box 4	converts all gene models to a form where they can be looked up by chromosome and coordinates	gff3_preprocess.sbatch: runs instance of gff3_preprocess.pl for each grass sp. 	Pipeline.pm Bio::SeqIO Bio::Tools::GFF		slurm	gff3 files for every grass sp	lookup tables for every grass sp Ensembl gene model by chr and coordinates
box 4	"for all HMM2 groups with missing or low-scoring members looks in grass genomes using genblastg. If hit is a novel gene model and matches HMM profile well, adopt as group member"	"dogenblast.sbatch : runs split-pipeline-statfiles.pl , 12 instances of dogenblast.pl. When complete join-pipeline-statfiles.pl to create finalHMM"	Pipeline.pm HMMs.pm Genblast.pm Bio::SeqIO	HMMER genBlastG	slurm	"HMM2 files of optimised groups, group composition file, all grass genome files, lookup tables for Ensembl gene models"	composition (finalHMM2.txt) multiple alignment files (*.msa.fa) and HMM files of final optimised groups. Novel genBlastG gene models used in final  groups.
box 5	Finds all grass pep top hits not yet used in groups and analyses them to find associated peps and to define supergroups	fhmmscan_grass.sbatch:  runs instances of hmmscan_allgm.pl final_hmm for each grass sp. Finally analyse-hmmscan-grasshits.pl	Pipeline.pm HMMs.pm Bio::SeqIO	HMMER	slurm	composition (finalHMM.txt) and HMMER database finalHMM  of final optimised groups. Grass gene model fasta files	look up tables to find universal_grass_groups using ID of any grass gene model that is a member or associated. Table of supergroups.
box 6	Finds all non-grass pep top hits to final_hmm and analyses them to define specificity for each group	fhmmscan_nongrass.sbatch:  runs instances of hmmscan_allgm.pl final_hmm for each non-grass sp. Finally compile-hmmscan-tophits.pl	Pipeline.pm HMMs.pm Bio::SeqIO	HMMER	slurm	composition (finalHMM.txt) and HMMER database finalHMM  of final optimised groups.Non-grass gene model fasta files	final universal_grass_peps set of universal groups with monocot- / commelinid-/ grass- specificity estimates for each group
